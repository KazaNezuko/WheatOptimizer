<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Albion Calculator - Wheat & Soup (Optimized)</title>

<!-- ==================== DEPENDENCIES ==================== -->
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.min.js"></script>

<!-- ==================== FONTS (Synthwave/Pixel) ==================== -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">

<style>
/* -------------------------------------------------
   1️⃣  CSS VARIABLES (Define the Synthwave Palette)
   ------------------------------------------------- */
:root {
    --neon-pink:   #ff00ff; /* Magenta */
    --neon-cyan:   #00ffff; /* Cyan */
    --neon-accent: #ffab40; /* Yellow/Orange for contrast */
    --color-text:  #e0e0ff;
    --color-dark:  #0a051a;
    --panel-bg:    rgba(10, 5, 30, 0.65);
}

/* -------------------------------------------------
   2️⃣  BASE STYLES (The VHS/Grid Feel)
   ------------------------------------------------- */
body {
    font-family: 'VT323', monospace; /* Monospaced font for CRT feel */
    background: linear-gradient(135deg, #0f0a1a, #1a0033, #00051a);
    color: var(--color-text);
    margin: 0;
    padding: 0;
    min-height: 100vh;
    overflow-x: hidden;
    position: relative;
    z-index: 1; /* Ensure content stays above the scanlines */
}

/* Background Glow (subtle sunset effect) */
body::before {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(ellipse at bottom, #ff00aa 0%, #ff00aa 20%, transparent 70%);
    opacity: 0.15;
    pointer-events: none;
    z-index: -1;
}

/* Grid Lines (Synthwave Ground Effect) */
body::after {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: 
        linear-gradient(rgba(0,255,255,0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0,255,255,0.05) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 10;
}

/* VHS Scanlines */
.scanlines {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: repeating-linear-gradient(
        0deg,
        rgba(0,0,0,0.15),
        rgba(0,0,0,0.15) 1px,
        transparent 1px,
        transparent 2px
    );
    pointer-events: none;
    z-index: 20;
    opacity: 0.4;
}

/* -------------------------------------------------
   3️⃣  TYPOGRAPHY & COMPONENTS STYLES
   ------------------------------------------------- */

.synth-font { font-family: 'Orbitron', sans-serif; }
.pixel-font { font-family: 'Press Start 2P', cursive; }

/* GLASS PANEL (Sharp edges, glowing border) */
.synth-panel {
    background: var(--panel-bg);
    backdrop-filter: blur(8px);
    border: 2px solid var(--neon-pink);
    border-radius: 0; /* Sharp 90s corners */
    box-shadow:
        0 0 20px rgba(255,0,255,0.6),
        inset 0 0 15px rgba(0,255,255,0.2);
    position: relative;
    overflow: hidden;
}
.synth-panel::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 3px;
    background: linear-gradient(90deg, var(--neon-pink), var(--neon-cyan));
}

/* INPUTS – NEON */
.synth-input {
    background: rgba(5, 2, 20, 0.7);
    border: 1px solid var(--neon-cyan);
    color: #cff;
    font-family: 'VT323', monospace;
    font-size: 1.2rem;
    padding: 0.6rem 1rem;
    transition: all 0.3s ease;
}
.synth-input:focus {
    outline: none;
    border-color: var(--neon-pink);
    box-shadow: 0 0 12px rgba(255,0,255,0.7);
}

/* BUTTON – NEON PINK/CYAN */
.synth-btn {
    background: #000;
    color: var(--neon-pink);
    font-family: 'Orbitron', sans-serif;
    border: 2px solid var(--neon-pink);
    padding: 0.4rem 1rem;
    cursor: pointer;
    text-transform: uppercase;
    letter-spacing: 2px;
    transition: all 0.3s;
    box-shadow: 0 0 8px rgba(255,0,255,0.5);
}
.synth-btn:hover {
    background: rgba(255,0,255,0.2);
    box-shadow: 0 0 15px rgba(255,0,255,0.9);
    transform: translateY(-2px); /* Subtle lift, no layout shift */
}

/* RESULTS CARD (Cyan focus) */
.results-card {
    background: rgba(5, 2, 20, 0.8);
    border: 3px solid var(--neon-cyan);
    box-shadow:
        0 0 25px rgba(0,255,255,0.6),
        inset 0 0 10px rgba(0,255,255,0.2);
    padding: 1.5rem;
}

/* PROFIT / LOSS BADGE */
.profit {
    background: rgba(0, 255, 170, 0.15);
    border: 2px solid #00ffaa;
    color: #00ffaa;
    padding: 0.4rem;
    text-align: center;
    font-family: 'Orbitron';
}
.loss {
    background: rgba(255, 50, 100, 0.15);
    border: 2px solid #ff00aa;
    color: #ff00aa;
}

/* SCROLLBAR */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: #0a0520; }
::-webkit-scrollbar-thumb { background: var(--neon-pink); border-radius: 3px; }
</style>
</head>

<body class="selection:bg-[#ff00ff] selection:text-white">
    <div class="scanlines"></div>
    <div id="root"></div>

    <script type="text/babel">
        /* -------------------------------------------------
           REACT CORE IMPORTS (Ensuring Babel finds them)
           ------------------------------------------------- */
        const { useState, useMemo } = React;
        const SEEDS_TOTAL = 144;

        /* -------------------------------------------------
           COMPOSANT : InputGroup (Nettoyé et fonctionnel)
           ------------------------------------------------- */
        const InputGroup = ({ label, value, onChange, unit, max }) => (
            <div class="flex flex-col gap-2">
                <label class="text-[10px] font-bold text-cyan-300 uppercase tracking-[4px] synth-font">
                    {label}
                </label>
                <div class="relative">
                    <input 
                        type="number"
                        value={value}
                        onChange={(e) => {
                            const val = parseFloat(e.target.value) || 0;
                            // Correction: on s'assure que l'onChange est appelé même si la valeur est 0 ou NaN
                            if (max !== undefined && val > max) onChange(max);
                            else onChange(val);
                        }}
                        class="w-full synth-input"
                    />
                    <span class="absolute right-3 top-1/2 -translate-y-1/2 text-[9px] text-cyan-300 uppercase">
                        {unit}
                    </span>
                </div>
            </div>
        );

        /* -------------------------------------------------
           MAIN APP COMPONENT
           ------------------------------------------------- */
        const App = () => {
            /* Initial States (Read-only for this cleaner version, updates through functions) */
            const [farming, setFarming] = useState({
                seedPrice: 2500,
                seedsRecovered: 126,
                wheatHarvested: 860,
                marketWheatPrice: 480
            });

            const [crafting, setCrafting] = useState({
                wheatPerCraft: 16,
                foodPerCraft: 10,
                returnRate: 15,
                wheatPriceUsed: 480
            });

            /* Core Logic Calculation */
            const results = useMemo(() => {
                const seedsBought = Math.max(0, SEEDS_TOTAL - farming.seedsRecovered);
                const realCycleCost = seedsBought * farming.seedPrice;
                const costPerWheat = farming.wheatHarvested > 0 ? realCycleCost / farming.wheatHarvested : 0;
                const diffMarket = farming.marketWheatPrice - costPerWheat;
                const isProfitable = costPerWheat < farming.marketWheatPrice;

                const effectiveWheatConsumed = crafting.wheatPerCraft * (1 - (crafting.returnRate / 100));
                const realCraftCost = effectiveWheatConsumed * crafting.wheatPriceUsed;
                const costPerFood = crafting.foodPerCraft > 0 ? realCraftCost / crafting.foodPerCraft : 0;

                return {
                    seedsBought,
                    realCycleCost: Math.round(realCycleCost),
                    costPerWheat: Math.round(costPerWheat),
                    diffMarket: Math.round(diffMarket),
                    isProfitable,
                    effectiveWheatConsumed: Number(effectiveWheatConsumed.toFixed(1)),
                    realCraftCost: Math.round(realCraftCost),
                    costPerFood: Math.round(costPerFood)
                };
            }, [farming, crafting]);

            /* Handler to sync crafting price with farming cost */
            const bindWheatPrice = () => {
                setCrafting(prev => ({ ...prev, wheatPriceUsed: results.costPerWheat }));
            };

            return (
                <div class="min-h-screen pb-16 px-4">
                    {/* ===== HEADER ===== */}
                    <header class="py-8 px-4 border-b-2 border-[#ff00ff] mb-10">
                        <div class="max-w-6xl mx-auto flex flex-col md:flex-row items-center justify-between gap-6">
                            <div class="flex items-center gap-5">
                                <div class="w-12 h-12 bg-[#ff00ff] flex items-center justify-center border-2 border-[#00ffff] rotate-3">
                                    <div class="pixel-font text-[#0a0520] text-[10px]">AO</div>
                                </div>
                                <div>
                                    <h1 class="synth-font text-4xl font-bold text-[#ff00ff] tracking-wider uppercase">
                                        ALBION ECONOMIZER
                                    </h1>
                                    <p class="pixel-font text-cyan-300 text-[8px] tracking-[4px] mt-2">
                                        SPECIALIZED CALCULATOR – WHEAT &amp; SOUP
                                    </p>
                                </div>
                            </div>
                        </div>
                    </header>

                    <main class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-10">
                        {/* ===== INPUT PANELS (Left) ===== */}
                        <div class="lg:col-span-7 space-y-8">
                            
                            {/* FARMING SECTION */}
                            <section class="synth-panel p-6">
                                <h2 class="synth-font text-[#00ffff] text-lg mb-5 border-b-2 border-[#00ffff] pb-2 uppercase tracking-widest">
                                    ▶ FARMING
                                </h2>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                                    <InputGroup label="Seed Price (Ag)" value={farming.seedPrice} 
                                                onChange={v => setFarming({...farming, seedPrice: v})} unit="Ag" />
                                    <InputGroup label="Seeds Recovered" value={farming.seedsRecovered} 
                                                onChange={v => setFarming({...farming, seedsRecovered: v})} max={SEEDS_TOTAL} unit="pcs" />
                                    <InputGroup label="Wheat Harvested" value={farming.wheatHarvested} 
                                                onChange={v => setFarming({...farming, wheatHarvested: v})} unit="pcs" />
                                    <InputGroup label="Market Wheat Price (Ag)" value={farming.marketWheatPrice} 
                                                onChange={v => setFarming({...farming, marketWheatPrice: v})} unit="Ag" />
                                </div>
                            </section>

                            {/* CRAFTING SECTION */}
                            <section class="synth-panel p-6">
                                <h2 class="synth-font text-[#00ffff] text-lg mb-5 border-b-2 border-[#00ffff] pb-2 uppercase tracking-widest">
                                    ▶ CRAFT FOOD (WHEAT SOUP)
                                </h2>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                                    {/* Wheat Cost Sync Button */}
                                    <div class="col-span-full mb-4">
                                        <div class="flex justify-between items-center mb-2">
                                            <label class="text-[10px] font-bold text-cyan-300 uppercase tracking-widest synth-font">Wheat Cost Used (Ag)</label>
                                            <button onClick={bindWheatPrice} class="synth-btn text-[9px] py-1 px-3">
                                                USE FARMING COST
                                            </button>
                                        </div>
                                        <input 
                                            type="number" 
                                            value={crafting.wheatPriceUsed} 
                                            onChange={e => setCrafting({...crafting, wheatPriceUsed: parseFloat(e.target.value) || 0})} 
                                            class="w-full synth-input"
                                        />
                                    </div>
                                    <InputGroup label="Wheat per Craft" value={crafting.wheatPerCraft} 
                                                onChange={v => setCrafting({...crafting, wheatPerCraft: v})} unit="pcs" />
                                    <InputGroup label="Food per Craft" value={crafting.foodPerCraft} 
                                                onChange={v => setCrafting({...crafting, foodPerCraft: v})} unit="pcs" />
                                    <div class="md:col-span-2">
                                        <InputGroup label="Craft Return Rate (%)" value={crafting.returnRate} 
                                                    onChange={v => setCrafting({...crafting, returnRate: v})} unit="%" max={100} />
                                    </div>
                                </div>
                            </section>
                        </div>

                        {/* ===== RESULTS (Right) ===== */}
                        <div class="lg:col-span-5">
                            <div class="results-card synth-font text-cyan-100">
                                {/* FARMING RESULTS */}
                                <div class="mb-10">
                                    <h3 class="pixel-font text-[#00ffff] text-center my-4 border-y-2 border-[#00ffff] py-2">FARMING SUMMARY</h3>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between"><span>Seeds Planted:</span> <span>{SEEDS_TOTAL}</span></div>
                                        <div class="flex justify-between"><span>Seeds Recovered:</span> <span>{farming.seedsRecovered}</span></div>
                                        <div class="flex justify-between"><span>Seeds Bought:</span> <span>{results.seedsBought}</span></div>
                                        <div class="flex justify-between"><span>Seed Price:</span> <span>{farming.seedPrice} Ag</span></div>
                                        <div class="flex justify-between border-t border-[#00ffff]/30 pt-2 text-base">
                                            <span>Real Cycle Cost:</span> <span>{results.realCycleCost.toLocaleString()} Ag</span>
                                        </div>
                                        
                                        <div class="pt-6 space-y-2">
                                            <div class="flex justify-between"><span>Wheat Harvested:</span> <span>{farming.wheatHarvested}</span></div>
                                            <div class="flex justify-between text-[#00ffaa]"><span>Cost per Wheat:</span> <span>{results.costPerWheat} Ag</span></div>
                                            <div class="flex justify-between"><span>Market Price:</span> <span>{farming.marketWheatPrice} Ag</span></div>
                                            <div class="flex justify-between border-t border-[#00ffff]/30 pt-2">
                                                <span>Profit/Diff:</span> <span>{results.diffMarket} Ag / wheat</span>
                                            </div>
                                            <div className={`mt-4 py-2 text-center text-xs uppercase tracking-widest border ${results.isProfitable ? 'profit' : 'loss'}`}>
                                                {results.isProfitable ? 'PROFITABLE!' : 'NOT PROFITABLE!'}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* FOOD RESULTS */}
                                <div>
                                    <h3 class="pixel-font text-[#00ffff] text-center my-4 border-y-2 border-[#00ffff] py-2">FOOD CRAFTING – WHEAT SOUP</h3>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between"><span>Wheat Consumed:</span> <span>{crafting.wheatPerCraft}</span></div>
                                        <div class="flex justify-between"><span>Return Rate:</span> <span>{crafting.returnRate}%</span></div>
                                        <div class="flex justify-between text-[#00ffaa]"><span>Effective Wheat Used:</span> <span>{results.effectiveWheatConsumed}</span></div>
                                        
                                        <div class="pt-6 space-y-2">
                                            <div class="flex justify-between"><span>Food Crafted:</span> <span>{crafting.foodPerCraft}</span></div>
                                            <div className="flex justify-between"><span>Real Craft Cost:</span> <span>{results.realCraftCost.toLocaleString()} Ag</span></div>
                                            <div className="flex justify-between border-t-2 border-[#00ffff]/30 pt-2 text-lg text-[#00ffaa]">
                                                <span>Cost per Food:</span> <span>{results.costPerFood.toLocaleString()} Ag</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="mt-10 pt-8 text-center opacity-60 select-none">
                                    <div className="inline-block border-2 border-[#ff00ff] px-4 py-2 pixel-font text-[#ff00ff] rotate-[-5deg] text-[8px] tracking-widest">
                                        OFFICIAL ALBION
                                    </div>
                                </div>
                            </div>
                        </div>
                    </main>

                    <footer class="max-w-6xl mx-auto px-4 mt-12 text-center pb-8">
                        <p class="pixel-font text-cyan-800 text-[8px] tracking-[5px]">
                            EXACT CALCULATIONS – PROTOCOL SECTIONS 3 & 4
                        </p>
                    </footer>
                </div>
            );
        };

        /* ------------------- RENDER ------------------- */
        const { createRoot } = ReactDOM;
        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>